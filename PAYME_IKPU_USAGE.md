# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ò–ö–ü–£ –∫–æ–¥–∞ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ

## –ß—Ç–æ —Ç–∞–∫–æ–µ –ò–ö–ü–£?

**–ò–ö–ü–£ –∫–æ–¥** - —ç—Ç–æ –≤–∞—à 16-–∑–Ω–∞—á–Ω—ã–π Merchant ID –≤ —Å–∏—Å—Ç–µ–º–µ Payme. –û–Ω –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –≤–∞—à —Å—á–µ—Ç.

–ü—Ä–∏–º–µ—Ä: `507144111111111`

## –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ò–ö–ü–£ –≤ –∫–æ–¥–µ?

### 1. –í –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# –ò–ö–ü–£ –∫–æ–¥ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–¥–µ—Å—å
PAYME_MERCHANT_ID=507144111111111
PAYME_KEY=0300BF8B4D537FD49D1F1E13B5215E58
```

### 2. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–ª–∞—Ç–µ–∂

–í —Ñ–∞–π–ª–µ [backend/controllers/paymentController.js](../backend/controllers/paymentController.js):

```javascript
if (provider === "payme") {
  // –ò–ö–ü–£ –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ URL —à–ª—é–∑–∞ Payme
  const merchantId = process.env.PAYME_MERCHANT_ID;
  
  paymentInitData = {
    redirectUrl: `https://checkout.paycom.uz/${merchantId}?orderId=${order._id}&amount=${Math.round(amount * 100)}`,
  };
}
```

**–ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- `https://checkout.paycom.uz/` - –∞–¥—Ä–µ—Å –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ —à–ª—é–∑–∞ Payme
- `${merchantId}` - –≤–∞—à –ò–ö–ü–£ –∫–æ–¥ (507144111111111)
- `?orderId=...` - ID –∑–∞–∫–∞–∑–∞ –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ
- `&amount=...` - —Å—É–º–º–∞ –≤ —Ç–∏–π–∏–Ω–∞—Ö (1 –£–ó–° = 100 —Ç–∏–π–∏–Ω–æ–≤)

### 3. –ü–æ–ª–Ω—ã–π URL –ø—Ä–∏–º–µ—Ä

–ï—Å–ª–∏ –≤–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- –ò–ö–ü–£: `507144111111111`
- Order ID: `60d5ec49c1234567890abcde`
- –°—É–º–º–∞: 50000 –£–ó–°

–¢–æ —Å—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç:
```
https://checkout.paycom.uz/507144111111111?orderId=60d5ec49c1234567890abcde&amount=5000000
```

---

## –®–∞–≥ –∑–∞ —à–∞–≥–æ–º: –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ò–ö–ü–£

### –®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç Payme

Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
```javascript
POST /api/payments/create
{
  "items": [...],
  "amount": 50000,
  "provider": "payme"
}
```

### –®–∞–≥ 2: Backend —á–∏—Ç–∞–µ—Ç –ò–ö–ü–£ –∏–∑ .env

```javascript
const merchantId = process.env.PAYME_MERCHANT_ID; // —á–∏—Ç–∞–µ—Ç –∏–∑ .env
```

### –®–∞–≥ 3: Backend —Å–æ–∑–¥–∞–µ—Ç URL —Å –ò–ö–ü–£

```javascript
redirectUrl: `https://checkout.paycom.uz/${merchantId}?...`
// https://checkout.paycom.uz/507144111111111?...
```

### –®–∞–≥ 4: Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É frontend

Frontend –ø–æ–ª—É—á–∞–µ—Ç:
```json
{
  "orderId": "60d5ec49c1234567890abcde",
  "provider": "payme",
  "paymentInitData": {
    "redirectUrl": "https://checkout.paycom.uz/507144111111111?orderId=60d5ec49c1234567890abcde&amount=5000000"
  }
}
```

### –®–∞–≥ 5: Frontend –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Payme

```javascript
window.location.href = redirectUrl;
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ñ–æ—Ä–º—É Payme —Å –≤–∞—à–∏–º —Å—á–µ—Ç–æ–º
```

### –®–∞–≥ 6: Payme –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç callback –Ω–∞ backend

Payme –≤—ã–∑—ã–≤–∞–µ—Ç –≤–∞—à `/api/payments/payme/callback` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- API Key (–∏–∑ Authorization header)
- Order ID (–¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–∫–∞–∑–∞)
- Amount (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É–º–º—ã)

### –®–∞–≥ 7: Backend –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑

–ó–∞–∫–∞–∑ –≤ –ë–î –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É.

---

## –ì–¥–µ –Ω–∞–π—Ç–∏ –ò–ö–ü–£ –∫–æ–¥?

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://merchant.paycom.uz
2. –í–æ–π—Ç–∏ —Å –≤–∞—à–∏–º–∏ —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. –í—ã–±—Ä–∞—Ç—å —Å–≤–æ–π —Å–µ—Ä–≤–∏—Å
4. –ò–ö–ü–£ –∫–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ "–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"

**–ò–ö–ü–£ –∫–æ–¥ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:**
```
507144111111111
```

---

## –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–æ–≤—ã–º –∏ –±–æ–µ–≤—ã–º –ò–ö–ü–£

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–µ—Å—Ç | Production |
|----------|------|-----------|
| –ò–ö–ü–£ –∫–æ–¥ | 507144 | –í–∞—à –∫–æ–¥ (16 —Ü–∏—Ñ—Ä) |
| URL | https://checkout.test.paycom.uz | https://checkout.paycom.uz |
| API Key | 0300BF8B4D537FD49D1F1E13B5215E58 | –í–∞—à –∫–ª—é—á |
| PAYME_TEST_MODE | true | false |

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ò–ö–ü–£ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –°–ø–æ—Å–æ–± 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL

–ó–∞–ø—É—Å—Ç–∏—Ç–µ backend –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:

```javascript
console.log('Redirect URL:', redirectUrl);
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
// https://checkout.paycom.uz/507144111111111?orderId=...&amount=...
```

### –°–ø–æ—Å–æ–± 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å callback

–ü–æ—Å–ª–µ –ø–ª–∞—Ç–µ–∂–∞ Payme –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç callback, –≤ –ª–æ–≥–∞—Ö —É–≤–∏–¥–∏—Ç–µ:

```
=== PAYME CALLBACK REQUEST ===
Body: {
  "jsonrpc": "2.0",
  "method": "CheckPerformTransaction",
  "params": { ... }
}
```

### –°–ø–æ—Å–æ–± 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
node test-payme.js

# –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–∞–∑ –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ
```

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

‚ö†Ô∏è **–ù–ï –¥–µ–ª–∞–π—Ç–µ:**
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –ò–ö–ü–£ –∫–æ–¥ –≤ Git (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ .env –∏ .gitignore)
- –ù–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –ò–ö–ü–£ –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞–º
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∂–µ—Å—Ç–∫–∏–π –∫–æ–¥ –ò–ö–ü–£ (–≤—Å–µ–≥–¥–∞ –∏–∑ –ø—Ä–æ—Ü–µ—Å—Å.env)

‚úÖ **–î–µ–ª–∞–π—Ç–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ò–ö–ü–£
- –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ò–ö–ü–£ –≤ .env —Ñ–∞–π–ª–µ (–≤ .gitignore)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –ò–ö–ü–£ –¥–ª—è —Ç–µ—Å—Ç–∞ –∏ production
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –æ–ø–ª–∞—Ç–µ

---

## –ö–æ–Ω–µ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ü–µ—Ä–µ–¥ production:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ .env —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ò–ö–ü–£
grep PAYME_MERCHANT_ID .env

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã
node test-payme.js

# 3. –°–æ–≤–µ—Ä—à–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
# –¢–∞–º –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
# "https://checkout.paycom.uz/507144111111111?..."

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–∫–∞–∑ –æ–±–Ω–æ–≤–∏–ª—Å—è –≤ –ë–î –Ω–∞ "paid"
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [PAYME_INTEGRATION.md](./PAYME_INTEGRATION.md)
- üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: [PAYME_QUICK_START.md](./PAYME_QUICK_START.md)
- ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç: [PAYME_CHECKLIST.md](./PAYME_CHECKLIST.md)
- üíª –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: [backend/controllers/paymentController.js](../backend/controllers/paymentController.js)
