# ‚úÖ IKPU –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–æ–≤–∞—Ä–æ–≤ - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ!

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ **IKPU –∫–æ–¥–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞**, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞–∫–∫–∞—É–Ω—Ç–∞.

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. CatalogData.ts
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `ikpuCode?: string` –≤ `CatalogItem`

```typescript
export type CatalogItem = {
  id: number;
  category: string;
  nameKey: string;
  price?: number;
  ikpuCode?: string;  // ‚Üê –ù–û–í–û–ï
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
};
```

### 2. paymentController.js
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `createOrderAndInitPayment` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ IKPU:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –∏–º–µ–µ—Ç `ikpuCode`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –≤—Å–µ IKPU –∫–æ–¥—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ (–æ–¥–Ω–æ–≥–æ vendora)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç IKPU –∏–∑ —Ç–æ–≤–∞—Ä–∞ –≤ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å—Å—ã–ª–∫–µ

```javascript
if (provider === "payme") {
  // –í–∞–ª–∏–¥–∞—Ü–∏—è IKPU
  for (const item of items) {
    if (!item.ikpuCode) {
      return error("Item missing IKPU code");
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ –æ—Ç –æ–¥–Ω–æ–≥–æ vendora
  const ikpuCodes = [...new Set(items.map(i => i.ikpuCode))];
  if (ikpuCodes.length > 1) {
    return error("Items from different merchants");
  }
  
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ IKPU –∏–∑ —Ç–æ–≤–∞—Ä–∞
  const itemIkpuCode = items[0].ikpuCode;
  const redirectUrl = 
    `https://checkout.paycom.uz/${itemIkpuCode}?orderId=...`;
}
```

### 3. Order.js (MongoDB Model)
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è IKPU –∫–æ–¥–æ–≤

```javascript
itemIkpuCodes: [{ type: String }]  // ‚Üê –ù–û–í–û–ï
```

### 4. PaymentIntegrationExample.tsx
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å IKPU:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è IKPU –ø–µ—Ä–µ–¥ –ø–ª–∞—Ç–µ–∂–æ–º
- –ü—Ä–∏–º–µ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ IKPU
- TypeScript —Ç–∏–ø—ã –≤–∫–ª—é—á–∞—é—Ç `ikpuCode`

## üìö –ù–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| **[IKPU_UPDATE.md](./IKPU_UPDATE.md)** | –≠—Ç–æ—Ç —Ñ–∞–π–ª - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| **[ITEM_IKPU_CODES.md](./ITEM_IKPU_CODES.md)** | –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± IKPU —Ç–æ–≤–∞—Ä–æ–≤ |
| **[HOW_TO_ADD_IKPU_CODES.md](./HOW_TO_ADD_IKPU_CODES.md)** | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é IKPU |

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –®–∞–≥ 1: –î–æ–±–∞–≤—å—Ç–µ IKPU –≤ –∫–∞—Ç–∞–ª–æ–≥

```typescript
// src/data/CatalogData.ts

export const items = [
  {
    id: 1,
    category: "injection",
    nameKey: "syring",
    price: 25000,
    ikpuCode: "507144111111111",  // ‚Üê –î–û–ë–ê–í–¨–¢–ï
  },
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å IKPU
];
```

### –®–∞–≥ 2: –í—Å–µ –≥–æ—Ç–æ–≤–æ!

Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç IKPU
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç IKPU –≤ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å—Å—ã–ª–∫–µ
- –°–æ—Ö—Ä–∞–Ω–∏—Ç IKPU –≤ –∑–∞–∫–∞–∑–µ

## ‚ú® –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–∫–∞–∑ —Å IKPU

```
–ó–∞–∫–∞–∑:
‚îú‚îÄ –¢–æ–≤–∞—Ä A (ikpuCode: "507144111111111")
‚îú‚îÄ –¢–æ–≤–∞—Ä B (ikpuCode: "507144111111111")  ‚Üê –û–î–ò–ù–ê–ö–û–í–´–ô
‚îî‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç: OK, –ø–ª–∞—Ç–µ–∂ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ø—ã—Ç–∫–∞ —Å–º–µ—à–∞—Ç—å —Ç–æ–≤–∞—Ä—ã

```
‚ùå –û—à–∏–±–∫–∞:
–ó–∞–∫–∞–∑:
‚îú‚îÄ –¢–æ–≤–∞—Ä A (ikpuCode: "507144111111111")
‚îú‚îÄ –¢–æ–≤–∞—Ä B (ikpuCode: "507144222222222")  ‚Üê –†–ê–ó–ù–´–ô
‚îî‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç: –û—à–∏–±–∫–∞ - —Ä–∞–∑–Ω—ã–µ vendor—ã
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å—Å—ã–ª–∫–∞

```
https://checkout.paycom.uz/507144111111111?orderId=abc123&amount=2500000
                        ^^^^^^^^^^^^^^^^
                        IKPU –∏–∑ —Ç–æ–≤–∞—Ä–∞
```

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–∞ Frontend

```typescript
interface CartItem {
  id: number;
  name: string;
  price: number;
  quantity: number;
  ikpuCode?: string;  // ‚Üê –ù–û–í–û–ï (16-digit Payme ID)
}
```

### –í –∑–∞–∫–∞–∑–µ (–ë–î)

```javascript
{
  _id: ObjectId(...),
  items: [{ id: 1, name: "Syring", ikpuCode: "507144111111111" }],
  amount: 25000,
  paymentProvider: "payme",
  paymentStatus: "pending",
  
  // –ù–û–í–û–ï –ü–û–õ–ï:
  itemIkpuCodes: ["507144111111111"]  // IKPU –∏–∑ —Ç–æ–≤–∞—Ä–æ–≤
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: IKPU –≤ –∫–∞—Ç–∞–ª–æ–≥–µ

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–æ–≤–∞—Ä –∏–º–µ–µ—Ç ikpuCode
console.log(catalogItem);
// { id: 1, ikpuCode: "507144111111111" }
```

### –¢–µ—Å—Ç 2: IKPU –≤ –∑–∞–∫–∞–∑–µ

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–∫–∞–∑ —Å–æ–¥–µ—Ä–∂–∏—Ç IKPU
POST /api/payments/create

// Request body:
{ items: [{ ikpuCode: "507144111111111" }], provider: "payme" }

// Response:
{ redirectUrl: "https://checkout.paycom.uz/507144111111111?..." }
                                          ^^^^^^^^^^^^^^^^
                                          IKPU –∏–∑ —Ç–æ–≤–∞—Ä–∞
```

### –¢–µ—Å—Ç 3: IKPU –≤ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Order —Å–æ—Ö—Ä–∞–Ω–∏–ª IKPU
db.orders.findOne()

{
  itemIkpuCodes: ["507144111111111"]  ‚Üê –°–û–•–†–ê–ù–ï–ù–û
}
```

## ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –Ø –¥–æ–ª–∂–µ–Ω –¥–æ–±–∞–≤–∏—Ç—å IKPU –∫–æ –≤—Å–µ–º —Ç–æ–≤–∞—Ä–∞–º?**
A: –î–∞, –µ—Å–ª–∏ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Payme –ø–ª–∞—Ç–µ–∂–∏.

**Q: –í—Å–µ —Ç–æ–≤–∞—Ä—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π IKPU?**
A: –î–∞, –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏. –≠—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É.

**Q: –ß—Ç–æ –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –±–µ–∑ IKPU?**
A: Backend –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É –¥–ª—è Payme –ø–ª–∞—Ç–µ–∂–µ–π:
```json
{
  "message": "Item missing IKPU code for Payme payment",
  "itemId": 1
}
```

**Q: –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Click/Uzum?**
A: Click –∏ Uzum –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π `PAYME_MERCHANT_ID`. IKPU –∫–æ–¥–∞ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –Ω–∏—Ö –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è.

**Q: –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ?**
A: –î–∞. IKPU –∫–æ–¥—ã –ø—É–±–ª–∏—á–Ω—ã–µ (–æ–Ω–∏ –≤ URL –ø–ª–∞—Ç–µ–∂–∞). –ù–∏–∫–∞–∫–∏—Ö —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è.

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|---------|
| [src/data/CatalogData.ts](./src/data/CatalogData.ts) | ‚Üê –î–æ–±–∞–≤—å—Ç–µ IKPU —Å—é–¥–∞ |
| [backend/controllers/paymentController.js](./backend/controllers/paymentController.js) | –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ IKPU |
| [backend/models/Order.js](./backend/models/Order.js) | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ IKPU –≤ –ë–î |
| [src/examples/PaymentIntegrationExample.tsx](./src/examples/PaymentIntegrationExample.tsx) | –ü—Ä–∏–º–µ—Ä—ã –Ω–∞ frontend |
| [HOW_TO_ADD_IKPU_CODES.md](./HOW_TO_ADD_IKPU_CODES.md) | ‚Üê –ß–ò–¢–ê–ô–¢–ï –°–ù–ê–ß–ê–õ–ê |
| [ITEM_IKPU_CODES.md](./ITEM_IKPU_CODES.md) | –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è |

## ‚úÖ Checklist

- [ ] –ü—Ä–æ—á–∏—Ç–∞–ª [HOW_TO_ADD_IKPU_CODES.md](./HOW_TO_ADD_IKPU_CODES.md)
- [ ] –î–æ–±–∞–≤–∏–ª IKPU –∫–æ–¥—ã –≤ CatalogData.ts
- [ ] –í—Å–µ IKPU –∫–æ–¥—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ (16 —Ü–∏—Ñ—Ä)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- [ ] –ü–ª–∞—Ç–µ–∂ –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ
- [ ] –ó–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î —Å itemIkpuCodes

## üéâ –ì–æ—Ç–æ–≤–æ!

–í–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç IKPU –∫–æ–¥—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è Payme –ø–ª–∞—Ç–µ–∂–µ–π!

**–ù–∞—á–Ω–∏—Ç–µ —Å:** [HOW_TO_ADD_IKPU_CODES.md](./HOW_TO_ADD_IKPU_CODES.md)

---

*–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: 30 —è–Ω–≤–∞—Ä—è 2026*
*–°—Ç–∞—Ç—É—Å: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é*
